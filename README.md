# üå¶Ô∏è WeatherAPI Service

–¶–µ–π —Å–µ—Ä–≤—ñ—Å –Ω–∞–¥–∞—î –ø–æ–≥–æ–¥–Ω—ñ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ HTTP API, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∞–¥–∞–ø—Ç–µ—Ä–∏ –¥–æ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ ‚Äî OpenWeather —Ç–∞ WeatherAPI. –¢–∞–∫–æ–∂ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –ª–æ–≥—ñ–∫–∞ –ø—ñ–¥–ø–∏—Å–æ–∫, –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –ª–∏—Å—Ç—ñ–≤ —Ç–∞ –∫–µ—à—É–≤–∞–Ω–Ω—è.

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **Go 1.23**
- **Docker + Docker Compose**
- **Prometheus metrics** (`/metrics`)
- –ê–¥–∞–ø—Ç–µ—Ä–∏ –¥–æ:
  - OpenWeather API
  - WeatherAPI
- –ö–µ—à: Noop –∞–±–æ Redis (–Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è)
- Email-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (—á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∏–π `MailerService`)
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ `graceful shutdown`

---

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `make` –¥–ª—è –∑–∞–ø—É—Å–∫—É:

```bash
make build                      # –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –æ–±—Ä–∞–∑–∏
make up                         # –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
make down                       # –ó—É–ø–∏–Ω–∏—Ç–∏ —ñ –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
make restart                    # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ (down + up)
make logs                       # –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏
make logs-weather_service       # –õ–æ–≥–∏ —Ç—ñ–ª—å–∫–∏ weather-—Å–µ—Ä–≤—ñ—Å—É
make logs-mailer_service        # –õ–æ–≥–∏ —Ç—ñ–ª—å–∫–∏ mailer-—Å–µ—Ä–≤—ñ—Å—É
make logs-subscription_service  # –õ–æ–≥–∏ —Ç—ñ–ª—å–∫–∏ subscription-—Å–µ—Ä–≤—ñ—Å—É
make logs-scheduler_service     # –õ–æ–≥–∏ —Ç—ñ–ª—å–∫–∏ scheduler-—Å–µ—Ä–≤—ñ—Å—É

make up-bench                   # –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∏–π –±–µ–Ω—á–º–∞—Ä–∫ gRPC —Ç–∞ REST
```

## üîß –ì–µ–Ω–µ—Ä–µ–∞—Ü—ñ—è –∫–æ–¥—É –∑ proto

- install the Buf CLI
  Windows:
    scoop install buf
  macOS or Linux:
    brew install bufbuild/buf/buf
  NPM:
    npm install @bufbuild/buf

- buf generate –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó


## üìä –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∏–π —Ç–µ—Å—Ç HTTP vs ConnectRPC (gRPC)

| –ü–æ–∫–∞–∑–Ω–∏–∫              | **HTTP REST (wrk)** | **gRPC ConnectRPC (ghz)** |
| --------------------- | ------------------- | ------------------------- |
| **–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤** | 70,529              | 20,000                    |
| **–ß–∞—Å —Ç–µ—Å—Ç—É**         | 15s                 | 5.75s                     |
| **RPS (–∑–∞–ø–∏—Ç—ñ–≤/—Å–µ–∫)** | **4,671**           | **3,477**                 |
| **–°–µ—Ä–µ–¥–Ω—è –∑–∞—Ç—Ä–∏–º–∫–∞**  | 31.14 ms            | 110.23 ms                 |
| **–ù–∞–π—à–≤–∏–¥—à–∏–π –∑–∞–ø–∏—Ç**  | ‚Äî                   | 13.87 ms                  |
| **–ù–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏–π**    | ‚Äî                   | 551.25 ms                 |
| **–ú–µ–¥—ñ–∞–Ω–∞ (p50)**     | ‚Äî                   | 100.93 ms                 |
| **p95**               | ‚Äî                   | 194.29 ms                 |
| **–ö–æ–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ**    | 200 OK              | 200 OK                    |
| **–ü—Ä–æ—Ç–æ–∫–æ–ª**          | HTTP/1.1            | HTTP/2 (plaintext, h2c)   |
| **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö**      | JSON                | JSON                      |
